<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>User Segment Analysis: Who Overpays When?</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif; margin: 0; padding: 20px; background: #f5f5f5; }
    .container { max-width: 1400px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    h1 { color: #2c3e50; text-align: center; margin-bottom: 10px; }
    .definitions { background: #f9f9f9; border-left: 4px solid #F7931A; padding: 20px; margin: 20px 0 30px 0; border-radius: 5px; }
    .definitions h3 { color: #F7931A; margin-top: 0; margin-bottom: 15px; }
    .def-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
    .def-item { padding: 10px; background: white; border-radius: 5px; border: 1px solid #e0e0e0; }
    .def-item strong { color: #2c3e50; display: block; margin-bottom: 5px; }
    .def-item .amount { color: #666; font-size: 14px; }
    .def-item .usd { color: #F7931A; font-size: 13px; margin-top: 3px; }
  #plotDiv { width: 100%; height: 900px; }
    .note { background: #fff9e6; border: 1px solid #ffd700; padding: 15px; border-radius: 5px; margin-top: 20px; font-size: 14px; color: #666; }
    .note strong { color: #F7931A; }
  </style>
  <script>
    window.addEventListener('DOMContentLoaded', function() {
      const payload = {"user_types": ["Dust", "Small", "Medium", "Large", "Whale"], "fullness_levels": [20, 40, 60, 80, 100], "time_periods": ["Morning", "Afternoon", "Evening", "Night"], "lines": [{"name": "Dust", "x": [20, 40, 60, 80, 100], "y": [1.1435015000833335, 1.1946169187916666, 1.2249755872619048, 1.235834516095238, 1.2354951122261906]}, {"name": "Small", "x": [20, 40, 60, 80, 100], "y": [1.6467475011011905, 1.5402370834761905, 1.5693669047857144, 1.6016397897559524, 1.609118169261905]}, {"name": "Medium", "x": [20, 40, 60, 80, 100], "y": [1.7363017560952383, 1.6423429780357144, 1.6675567004404763, 1.7078552051785716, 1.7126683067142856]}, {"name": "Large", "x": [20, 40, 60, 80, 100], "y": [1.865365676779762, 1.7569423938690476, 1.7770427579642858, 1.808451493386905, 1.8217910534285713]}, {"name": "Whale", "x": [20, 40, 60, 80, 100], "y": [2.0619886166190478, 1.8171596694940475, 1.8630322646607143, 1.9083074824880955, 1.9292925389702382]}], "bars_periods": [{"name": "Morning", "x": ["Dust", "Small", "Medium", "Large", "Whale"], "y": [1.1910537937047618, 1.6340212960619047, 1.7736202431619046, 1.918804968847619, 1.968999511604762]}, {"name": "Afternoon", "x": ["Dust", "Small", "Medium", "Large", "Whale"], "y": [1.249447891557143, 1.5235321905857144, 1.5779130237952381, 1.6335126045238095, 1.7253178007142858]}, {"name": "Evening", "x": ["Dust", "Small", "Medium", "Large", "Whale"], "y": [1.2263405409761905, 1.5206072874999998, 1.5731821766857144, 1.6349435133857144, 1.7737048138904763]}, {"name": "Night", "x": ["Dust", "Small", "Medium", "Large", "Whale"], "y": [1.1606966813285715, 1.695526784557143, 1.8486645135285715, 2.0364136135857143, 2.1958023315761905]}], "bars_impact": [{"name": "20% full", "x": ["Dust", "Small", "Medium", "Large", "Whale"], "y": [116.48269569679572, 64.40228920962984, 50.99735575904496, 29.38518381468153, 15.677093818167428]}, {"name": "40% full", "x": ["Dust", "Small", "Medium", "Large", "Whale"], "y": [129.33936462327148, 68.56920596641956, 67.61249414098873, 33.96114335187854, 19.178696400094267]}, {"name": "60% full", "x": ["Dust", "Small", "Medium", "Large", "Whale"], "y": [128.99950142440505, 77.5698183381566, 58.265095010111686, 33.11536547591435, 18.80789532218184]}, {"name": "80% full", "x": ["Dust", "Small", "Medium", "Large", "Whale"], "y": [119.98647919476912, 65.44385447342161, 52.33478534250714, 30.618637388263956, 17.08133825077363]}, {"name": "100% full", "x": ["Dust", "Small", "Medium", "Large", "Whale"], "y": [104.25159278522459, 63.394454724918866, 50.54983688312765, 28.96523767586376, 16.02572108677252]}], "bubbles": {"x": [19.083836495341373, 35.113820450751035, 39.70259098498741, 43.63888359810731, 46.616084970195985], "y": [1.2068847268916667, 1.5934218896761905, 1.6933449892928572, 1.8059186750857141, 1.9159561144464285], "text": ["Dust", "Small", "Medium", "Large", "Whale"], "size": [48.0, 18.28, 14.83, 12.99, 12.0], "color": [599.05963372, 339.37962271, 279.75956714, 156.04556771, 86.77074488]}};

      const userTypes = payload.user_types;
      const fullnessLevels = payload.fullness_levels;
      const timePeriods = payload.time_periods;

      // 1) Lines by user type
      const traces1 = payload.lines.map(l => ({
        x: l.x, y: l.y, type: 'scatter', mode: 'lines+markers', name: l.name,
        line: { width: 2 }, marker: { size: 8 }, legendgroup: 'users', xaxis: 'x', yaxis: 'y'
      }));

      // 2) Bars by time period
      const traces2 = payload.bars_periods.map(b => ({
        x: b.x, y: b.y, type: 'bar', name: b.name, legendgroup: 'periods', xaxis: 'x2', yaxis: 'y2'
      }));

      // 3) Bars: Economic impact distribution (BTC)
      const traces3 = payload.bars_impact.map(b => ({
        x: b.x, y: b.y, type: 'bar', name: b.name, showlegend: false, xaxis: 'x3', yaxis: 'y3'
      }));

      // 4) Bubble scatter
      const bubble = payload.bubbles;
      const trace4 = {
        x: bubble.x, y: bubble.y, mode: 'markers+text', type: 'scatter', text: bubble.text,
        textposition: 'top center', xaxis: 'x4', yaxis: 'y4',
        marker: {
          size: bubble.size, sizemode: 'diameter', sizemin: 6,
          color: bubble.color, colorscale: 'Viridis', showscale: true,
          colorbar: {
            title: 'BTC Overpaid', titleside: 'right', thickness: 15, len: 0.5, x: 1.02, y: 0.25
          }
        },
        showlegend: false
      };

      const data = [...traces1, ...traces2, ...traces3, trace4];

      const layout = {
        title: { text: 'User Segment Analysis: Who Overpays When?', font: { size: 20 } },
        grid: { rows: 2, columns: 2, pattern: 'independent', roworder: 'top to bottom' },
        xaxis:  { title: 'Block Fullness (%)', domain: [0, 0.45], anchor: 'y' },
        yaxis:  { title: 'Median Overpay Ratio', domain: [0.55, 1], anchor: 'x' },
        xaxis2: { title: 'User Type', domain: [0.55, 1], anchor: 'y2' },
        yaxis2: { title: 'Median Overpay Ratio', domain: [0.55, 1], anchor: 'x2' },
        xaxis3: { title: 'User Type', domain: [0, 0.45], anchor: 'y3' },
        yaxis3: { title: 'Total BTC Overpaid', domain: [0, 0.40], anchor: 'x3' },
        xaxis4: { title: '>2Ã— Overpay (%)', domain: [0.55, 1], anchor: 'y4' },
        yaxis4: { title: 'Median Overpay Ratio', domain: [0, 0.40], anchor: 'x4' },
        annotations: [
          { text: 'Overpayment by User Type & Fullness', x: 0.225, y: 1.05, xref: 'paper', yref: 'paper', showarrow: false, font: { size: 14, color: '#2c3e50' } },
          { text: 'Time Period Effects by User Type',   x: 0.775, y: 1.05, xref: 'paper', yref: 'paper', showarrow: false, font: { size: 14, color: '#2c3e50' } },
          { text: 'Economic Impact Distribution',       x: 0.225, y: 0.48, xref: 'paper', yref: 'paper', showarrow: false, font: { size: 14, color: '#2c3e50' } },
          { text: 'Behavioral Patterns',                x: 0.775, y: 0.48, xref: 'paper', yref: 'paper', showarrow: false, font: { size: 14, color: '#2c3e50' } }
        ],
  legend: { orientation: 'h', y: -0.15, x: 0.5, xanchor: 'center', yanchor: 'top', bgcolor: 'rgba(255,255,255,0.9)', bordercolor: '#e0e0e0', borderwidth: 1, tracegroupgap: 30 },
  margin: { l: 60, r: 100, t: 80, b: 150 }, height: 900, showlegend: true
      };

      const config = { responsive: true, displayModeBar: true, displaylogo: false, modeBarButtonsToRemove: ['pan2d','lasso2d','select2d'] };
      Plotly.newPlot('plotDiv', data, layout, config);
    });
  </script>
</head>
<body>
  <div class="container">
    <h1>User Segment Analysis: Who Overpays When?</h1>
    <div class="definitions">
      <h3>Transaction Size Categories (at $100,000/BTC)</h3>
      <div class="def-grid">
        <div class="def-item"><strong>ðŸ”µ Dust</strong><div class="amount">< 0.01 BTC</div><div class="usd">< $1,000</div></div>
        <div class="def-item"><strong>ðŸŸ¢ Small</strong><div class="amount">0.01 - 0.1 BTC</div><div class="usd">$1,000 - $10,000</div></div>
        <div class="def-item"><strong>ðŸŸ¡ Medium</strong><div class="amount">0.1 - 1 BTC</div><div class="usd">$10,000 - $100,000</div></div>
        <div class="def-item"><strong>ðŸŸ  Large</strong><div class="amount">1 - 10 BTC</div><div class="usd">$100,000 - $1M</div></div>
        <div class="def-item"><strong>ðŸ”´ Whale</strong><div class="amount">> 10 BTC</div><div class="usd">> $1 Million</div></div>
      </div>
    </div>
    <div id="plotDiv"></div>
    <div class="note">
      <strong>Key Insights:</strong>
      <ul style="margin: 10px 0 0 0; padding-left: 25px;">
        <li><strong>Dust transactions</strong> often overpay the most (low stakes, less optimization)</li>
        <li><strong>Whales</strong> tend to be more efficient, especially during congestion</li>
        <li><strong>Weekend mornings</strong> may show the highest overpayment across types</li>
        <li><strong>Economic impact</strong> concentrates in Medium and Large transactions</li>
      </ul>
    </div>
  </div>
  <script>/* Plot injected via payload above */</script>
</body>
</html>
